### Тестовое задание 5Элемент

Скрипты выполняются в airlfow. Код дагов расзмещен в папке dags.

Алгоритм:
0. db_init.sql инициалиалищирует ДБ, пользователя, схему и первичные данные; [ER-диагрмма достпна по ссылке](https://dbdiagram.io/e/6886aafacca18e685cf2b0ae/6886ab5fcca18e685cf2b5a2);

1. Пример данных и csv файлы размещаются в smb(cifs) шаре в папках /test_5element/xlsx_input и /test_5element/csv_output";
   - Параметры шары правильно передавать через переменные ailrfow, в коде указано для простоты и наглядности; 
2. Даг xlsx_to_csv:
    - Получает первый xlsx файл из smb шары по указаному пути;
    - Указанные листы в конфиге преобразовывает в csv и сохраняет по второму пути шары;
    - Таскфлоу стиль + @task.virtualenv используется для изоляции выполнения и использует временное окружение;
    - Читает xlsx файл, и по слварю и названию листов, размещает в шаре csv файлы. Оббработка с помощью pandas;
3. Даг load_csv_dag:
    - Таска process_csv_task:
        - Параметры шары и подключения к бд нужно передавать через переменные ailrfow и airflow onnections, в коде указано для простоты и наглядности;
        - Таскфлоу стиль + @task.virtualenv используется для изоляции выполнения и использует временное окружение;
        - Получает csv файлы из smb шары;
        - В исходных данных содержаться лексические ошибки в полях, содержащих "тип" или "тема" в названии. Значения этих полей во всех csv файлах проверяются через Яндекс Спеллер, и в случае оишбки, исправляются;
        - На листе "Опросы" случаным числом от 1 до 10 заполняются отметки в полях со словом "Вопрос";
        - Готовый датафрейм файла вставляется в таблицу бд в соответствии опредленному словарю;
        - Файл удаляется из шары после обработки;
    - Таска aggregate_reviews_task:
        - Хранит sql запрос для формировния итоговой таблицы. sql сработает быстрее, чем обработка на pyhton, проще читать и отлаживать;
        - Таска должна выполнятся через PostgeresOperator, кол запроса должен лежать в соседнем файле возле дага. В коде оформлено через psycopg2 для наглядности;
    - Таска update_indexes_task:
        - Пересчитывает индексы в итоговой таблице.
